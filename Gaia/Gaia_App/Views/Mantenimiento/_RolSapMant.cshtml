@model  Gaia.DAL.Model.Usuario

<style>
    .switch {
        font-size: 1rem;
        position: relative;
    }

        .switch input {
            position: absolute;
            height: 1px;
            width: 1px;
            background: none;
            border: 0;
            clip: rect(0 0 0 0);
            clip-path: inset(50%);
            overflow: hidden;
            padding: 0;
        }

            .switch input + label {
                position: relative;
                min-width: calc(calc(2.375rem * 0.8) * 2);
                border-radius: calc(2.375rem * 0.8);
                height: calc(2.375rem * 0.8);
                line-height: calc(2.375rem * 0.8);
                display: inline-block;
                cursor: pointer;
                outline: none;
                user-select: none;
                vertical-align: middle;
                text-indent: calc(calc(calc(2.375rem * 0.8) * 2) + 0.5rem);
            }

                .switch input + label::before,
                .switch input + label::after {
                    content: "";
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: calc(calc(2.375rem * 0.8) * 2);
                    bottom: 0;
                    display: block;
                }

                .switch input + label::before {
                    right: 0;
                    background-color: #dee2e6;
                    border-radius: calc(2.375rem * 0.8);
                    transition: 0.2s all;
                }

                .switch input + label::after {
                    top: 2px;
                    left: 2px;
                    width: calc(calc(2.375rem * 0.8) - calc(2px * 2));
                    height: calc(calc(2.375rem * 0.8) - calc(2px * 2));
                    border-radius: 50%;
                    background-color: white;
                    transition: 0.2s all;
                }

            .switch input:checked + label::before {
                background-color: #08d;
            }

            .switch input:checked + label::after {
                margin-left: calc(2.375rem * 0.8);
            }

            .switch input:focus + label::before {
                outline: none;
                box-shadow: 0 0 0 0.2rem rgba(0, 136, 221, 0.25);
            }

            .switch input:disabled + label {
                color: #868e96;
                cursor: not-allowed;
            }

                .switch input:disabled + label::before {
                    background-color: #e9ecef;
                }

        .switch.switch-h {
            font-size: 0.875rem;
        }

            .switch.switch-h input + label {
                min-width: calc(calc(1.9375rem * 0.8) * 2);
                height: calc(1.9375rem * 0.8);
                line-height: calc(1.9375rem * 0.8);
                text-indent: calc(calc(calc(1.9375rem * 0.8) * 2) + 0.5rem);
            }

                .switch.switch-h input + label::before {
                    width: calc(calc(1.9375rem * 0.8) * 2);
                }

                .switch.switch-h input + label::after {
                    width: calc(calc(1.9375rem * 0.8) - calc(2px * 2));
                    height: calc(calc(1.9375rem * 0.8) - calc(2px * 2));
                }

            .switch.switch-h input:checked + label::after {
                margin-left: calc(1.9375rem * 0.8);
            }

        .switch.switch-lg {
            font-size: 1.25rem;
        }

            .switch.switch-lg input + label {
                min-width: calc(calc(3rem * 0.8) * 2);
                height: calc(3rem * 0.8);
                line-height: calc(3rem * 0.8);
                text-indent: calc(calc(calc(3rem * 0.8) * 2) + 0.5rem);
            }

                .switch.switch-lg input + label::before {
                    width: calc(calc(3rem * 0.8) * 2);
                }

                .switch.switch-lg input + label::after {
                    width: calc(calc(3rem * 0.8) - calc(2px * 2));
                    height: calc(calc(3rem * 0.8) - calc(2px * 2));
                }

            .switch.switch-lg input:checked + label::after {
                margin-left: calc(3rem * 0.8);
            }

        .switch + .switch {
            margin-left: 1rem;
        }
</style>

@Html.Hidden("hfidRol")
<div class="content">
    <div class="flex-grid">
        <div class="row padding10 flex-jus-center">
            <div class="cell size12 padding10 no-padding-left">
                <div data-role="window" class="window">
                    <div class="window-caption">
                        <span class="window-caption-title">Rol</span>
                    </div>
                    <div class="window-content">
                        <div class="row flex-just-center">
                            <div class="cell size5">
                                <div class="row flex-just-center">
                                    <div class="cell size5">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.UsuarioId, new { id = "txtNombre", PlaceHolder = "Nombre" })
                                            @Html.ValidationMessage("nombre", "* Campo Requerido *", new { id = "lblnombrer", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size5">
                                        <label class="input-control password full-size">
                                            @Html.TextBoxFor(model => model.Password, new { id = "txtDescripcion", PlaceHolder = "Descripción" })
                                            @Html.ValidationMessage("descripcion", "* Campo Requerido *", new { id = "lbldescripcionr", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>                                                               
                            </div>
                            <div class="cell size2">
                                <div class="row flex-just-center" id="blnBajaRol">
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="activoblnBajaRol" value="true">
                                        <span class="check"></span>
                                        <span class="caption">DeBaja</span>
                                    </label>
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="inactivoblnBajaRol" value="false" checked>
                                        <span class="check"></span>
                                        <span class="caption">DeAlta</span>
                                    </label>
                                </div>
                                <div class="row flex-just-center" id="blnActivoRol">
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="inactivoblnActivoRol" value="false">
                                        <span class="check"></span>
                                        <span class="caption">Inactivo</span>
                                    </label>
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="activoblnActivoRol" value="true" checked>
                                        <span class="check"></span>
                                        <span class="caption">Activo</span>
                                    </label>
                                </div>
                                <div class="row flex-just-center padding10" id="blnDel">
                                    <div class="item-btn">
                                        <div class="container-switch">
                                            <span class="switch switch-h">
                                                <input type="checkbox" class="switch" id="switch-h" checked>
                                                <label for="switch-h">Es Indefinido?</label>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="cell size5">                                                                
                                <div class="row flex-just-center">
                                    <div class="cell size5">
                                        <div class="input-control text">
                                            <span data-role="hint" data-hint-mode="2" data-hint="dd/mm/aaaa" data-hint-position="top">
                                                @Html.TextBox("fechainicio", null, new { id = "txtFDesde", PlaceHolder = "Fecha Inicio" })
                                            </span>
                                        </div>                                        
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size5">
                                        <div class="input-control text">
                                            <span data-role="hint" data-hint-mode="2" data-hint="dd/mm/aaaa" data-hint-position="top">
                                                @Html.TextBox("fechafin", null, new { id = "txtFHasta", PlaceHolder = "Fecha Fin" })
                                            </span>
                                        </div>
                                    </div>
                                </div>                                
                            </div>                            
                        </div>
                        <div class="row flex-just-center">
                            <div class="toolbar">
                                <div class="toolbar-section">
                                    <button class="image-button ribbed-darkBlue" data-tabcontinuar="data-tabcontinuar" onclick="AgregarRolSap()" id="btnGuardaRolSap">
                                        <span class="fg-white">Guardar</span>
                                        <span class="icon mif-floppy-disk fg-white bg-darkBlue"></span>
                                    </button>
                                    <button class="image-button ribbed-darkOrange" data-tabcontinuar="data-tabcontinuar" id="btnActualizarRolSap" style="display: none" onclick="ActualizarRolSap()">
                                        <span class="fg-white">Actualizar</span>
                                        <span class="icon mif-pencil fg-white bg-darkOrange"></span>
                                    </button>
                                    <button class="image-button ribbed-darkEmerald" data-tabcontinuar="data-tabcontinuar" id="btnNuevoRolSap" onclick="btnNuevoRolSap()">
                                        <span class="fg-white">Nuevo</span>
                                        <span class="icon mif-plus fg-white bg-darkEmerald"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
            $(document).ready(function () {
                $('#blnBajaRol  input[type=checkbox]').click(function () {
                    $('#blnBajaRol  input[type=checkbox]').prop("checked", false);
                    $(this).prop("checked", true);
                });
                $('#blnActivoRol  input[type=checkbox]').click(function () {
                    $('#blnActivoRol  input[type=checkbox]').prop("checked", false);
                    $(this).prop("checked", true);
                });
                $("#txtFDesde").inputmask("99/99/9999");
                $("#txtFHasta").inputmask("99/99/9999");                
                $('#txtFHasta').prop("disabled", true);
                $("#switch-h").on('change', function () {
                    if ($(this).is(':checked')) { $("#txtFHasta").prop('disabled', true); }
                    else { $("#txtFHasta").prop('disabled', false); }
                });                
            })

            function AgregarRolSap() {
                var bandera = true;
                var roljson;
                showalertify();

                if ($('#txtNombre').val().toString().length < 1) {
                    $("#lblnombrer").show();
                    bandera = false;
                }

                if ($('#txtDescripcion').val().toString().length < 1) {
                    $("#lbldescripcionr").show();
                    bandera = false;
                }

                if (bandera == true) {
                    $("#lblnombrer").hide();
                    $("#lbldescripcionr").hide();

                    var listaCheck = $("#blnBajaRol input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            DeBaja = value.value
                        }
                    });

                    var listaCheck = $("#blnActivoRol input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            Activo = value.value
                        }
                    });

                    if ($("#switch-h").is(':checked')) {
                        roljson = JSON.stringify({"nombre": $('#txtNombre').val(), "descripcion": $('#txtDescripcion').val(), "esIndefinido": "true", "FechaInicioRol": $("#txtFDesde").val(), "DeBaja": DeBaja, "blnActivo": Activo });
                    }
                    else {
                        roljson = JSON.stringify({"nombre": $('#txtNombre').val(), "descripcion": $('#txtDescripcion').val(), "esIndefinido": "false", "FechaInicioRol": $("#txtFDesde").val(), "FechaFinRol": $("#txtFHasta").val(), "DeBaja": DeBaja, "blnActivo": Activo });
                    }                    

                    var url = obtenerURL('/Mantenimiento/GuardarRolSap?json=' + roljson);
                    $.post(url)
                        .done(function (data) {
                            var listado = JSON.parse(data);

                            if (listado.Resultado === "true") {
                                $('#frRolSap').empty();
                                $('#frRolSap').load(obtenerURL("/Mantenimiento/ListaPermisoSap"));
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Confirmación', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                            else {
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        })
                }
                else {
                    closealertify();
                    alertify.alert().destroy();
                    alertify.alert('Advertencia', 'Llenar todos los campos obligatorios');
                    alertify.alert().setting('modal', true);
                }
            }

            function ActualizarRolSap() {
                var bandera = true;
                var roljson;
                showalertify();

                if ($('#txtNombre').val().toString().length < 1) {
                    $("#lblnombrer").show();
                    bandera = false;
                }

                if ($('#txtDescripcion').val().toString().length < 1) {
                    $("#lbldescripcionr").show();
                    bandera = false;
                }

                if (bandera == true) {
                    $("#lblnombrer").hide();
                    $("#lbldescripcionr").hide();

                    var listaCheck = $("#blnBajaRol input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            DeBaja = value.value
                        }
                    });

                    var listaCheck = $("#blnActivoRol input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            Activo = value.value
                        }
                    });

                    if (DeBaja == "true") {
                        if ($("#switch-h").is(':checked')) {
                            roljson = JSON.stringify({ "nombre": $('#txtNombre').val(), "descripcion": $('#txtDescripcion').val(), "esIndefinido": "true", "FechaInicioRol": $("#txtFDesde").val(), "DeBaja": DeBaja, "FechaBaja": formatFechaHoras(new Date), "blnActivo": Activo });
                        }
                        else {
                            roljson = JSON.stringify({ "nombre": $('#txtNombre').val(), "descripcion": $('#txtDescripcion').val(), "esIndefinido": "false", "FechaInicioRol": $("#txtFDesde").val(), "FechaFinRol": $("#txtFHasta").val(), "DeBaja": DeBaja, "FechaBaja": formatFechaHoras(new Date), "blnActivo": Activo });
                        }
                    }
                    else {
                        if ($("#switch-h").is(':checked')) {
                            roljson = JSON.stringify({ "nombre": $('#txtNombre').val(), "descripcion": $('#txtDescripcion').val(), "esIndefinido": "true", "FechaInicioRol": $("#txtFDesde").val(), "DeBaja": DeBaja, "blnActivo": Activo });
                        }
                        else {
                            roljson = JSON.stringify({ "nombre": $('#txtNombre').val(), "descripcion": $('#txtDescripcion').val(), "esIndefinido": "false", "FechaInicioRol": $("#txtFDesde").val(), "FechaFinRol": $("#txtFHasta").val(), "DeBaja": DeBaja, "blnActivo": Activo });
                        }
                    }

                    var url = obtenerURL('/Mantenimiento/ActualizarRolSap?json=' + roljson + '&IdRol=' + $("#hfidRol").val());
                    $.post(url)
                        .done(function (data) {
                            var listado = JSON.parse(data);

                            if (listado.Resultado === "true") {
                                $('#frRolSap').empty();
                                $('#frRolSap').load(obtenerURL("/Mantenimiento/ListaPermisoSap"));
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Confirmación', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                            else {
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        })
                }
                else {
                    closealertify();
                    alertify.alert().destroy();
                    alertify.alert('Advertencia', 'Llenar todos los campos obligatorios');
                    alertify.alert().setting('modal', true);
                }
            }

            function btnNuevoRolSap() {
                $('#txtNombre').val("");
                $('#txtDescripcion').val("");                
                $('#blnBajaRol input[type=checkbox]').prop("checked", false);
                $('#inactivoblnBajaRol').prop('checked', true);
                $('#blnActivoRol input[type=checkbox]').prop("checked", false);
                $('#inactivoblnActivoRol').prop('checked', true);
                $('#switch-h').prop('checked', true);
                $('#txtFDesde').val("");
                $('#txtFHasta').val("");
                $('#btnActualizarRolSap').hide();
                $('#btnGuardaRolSap').show();
            }  
        </script>
    , true);
}

