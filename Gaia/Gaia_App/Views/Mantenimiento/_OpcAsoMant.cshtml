@model  Gaia.DAL.Model.catOpcion

<div class="content">
    <div class="flex-grid">
        <div class="row padding10 flex-jus-center">
            <div class="cell size8 padding10 no-padding-left">
                <div data-role="window" class="window">
                    <div class="window-caption">
                        <span class="window-caption-title">Opciones Asociadas</span>
                    </div>
                    <div class="window-content">
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.OpcionId, new { id = "txtOpcionId", PlaceHolder = "OpcionId" })
                                    @Html.ValidationMessage("opcionid", "* Campo Requerido *", new { id = "lblopcionid", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.Nivel, new { id = "txtNivel", PlaceHolder = "Nivel" })
                                    @Html.ValidationMessage("nivel", "* Campo Requerido *", new { id = "lblnivel", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.PadreId, new { id = "txtPadreId", PlaceHolder = "PadreId" })
                                    @Html.ValidationMessage("padreid", "* Campo Requerido *", new { id = "lblpadreid", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.Opcion, new { id = "txtOpcion", PlaceHolder = "Opcion" })
                                    @Html.ValidationMessage("opcion", "* Campo Requerido *", new { id = "lblopcion", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.OpcionTipo, new { id = "txtOpcionTipo", PlaceHolder = "OpcionTipo" })
                                    @Html.ValidationMessage("opciontipo", "* Campo Requerido *", new { id = "lblopciontipo", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.Mapeo, new { id = "txtMapeo", PlaceHolder = "Mapeo" })
                                    @Html.ValidationMessage("mapeo", "* Campo Requerido *", new { id = "lblmapeo", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.NombreIcono, new { id = "txtNombreIcono", PlaceHolder = "NombreIcono" })
                                    @Html.ValidationMessage("nombreicono", "* Campo Requerido *", new { id = "lblnombreicono", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.DescripcionGeneral, new { id = "txtDesGen", PlaceHolder = "Descripción" })
                                    @Html.ValidationMessage("desgen", "* Campo Requerido *", new { id = "lbldesgen", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center" id="ActivoOpc">
                            <label class="input-control checkbox small-check">
                                <input type="checkbox" id="activoopc" value="true" checked>
                                <span class="check"></span>
                                <span class="caption">Activo</span>
                            </label>
                            <label class="input-control checkbox small-check">
                                <input type="checkbox" id="inactivoopc" value="false">
                                <span class="check"></span>
                                <span class="caption">Inactivo</span>
                            </label>
                        </div>
                        <div class="row flex-just-center">
                            <div class="toolbar">
                                <div class="toolbar-section">
                                    <button class="image-button ribbed-darkBlue" data-tabcontinuar="data-tabcontinuar" id="btnGuardaOpcAso" onclick="AgregarOpcAso()">
                                        <span class="fg-white">Guardar</span>
                                        <span class="icon mif-floppy-disk fg-white bg-darkBlue"></span>
                                    </button>
                                    <button class="image-button ribbed-darkOrange" data-tabcontinuar="data-tabcontinuar" id="btnActualizarOpcAso" onclick="ActualizarOpcAso()" style="display: none">
                                        <span class="fg-white">Actualizar</span>
                                        <span class="icon mif-pencil fg-white bg-darkOrange"></span>
                                    </button>
                                    <button class="image-button ribbed-darkEmerald" data-tabcontinuar="data-tabcontinuar" id="btnNuevoOpcAso" onclick="NuevaOpcAso()">
                                        <span class="fg-white">Nuevo</span>
                                        <span class="icon mif-plus fg-white bg-darkEmerald"></span>
                                    </button>
                                </div> 
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginScriptContext())
    {
        Html.AddScriptBlock(
            @<script type="text/javascript">
                function ActualizarOpcAso() {
                    var bandera = true;
                    var FechaBaja = null;
                    if ($('#txtOpcionId').val().toString().length < 1) {
                        $("#lblopcionid").show();
                        bandera = false;
                    }
                    if ($('#txtOpcion').val().toString().length < 1) {
                        $("#lblopcion").show();
                        bandera = false;
                    }
                    if ($('#txtOpcionTipo').val().toString().length < 1) {
                        $("#lblopciontipo").show();
                        bandera = false;
                    }
                    if (bandera == true) {
                        showalertify();
                        $("#lblopcionid").hide();
                        $("#lblopcion").hide();
                        $("#lblopciontipo").hide();

                        var listaCheck = $("#ActivoOpc input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                Activo = value.value
                                if (Activo === "false") {
                                    FechaBaja = formatFechaHoras(new Date)
                                }
                            }
                        })

                        var opcionjson = JSON.stringify({ "OpcionId": $('#txtOpcionId').val().toString(), "Opcion": $('#txtOpcion').val().toString(), "OpcionTipo": $('#txtOpcionTipo').val().toString(), "Mapeo": $.trim($('#txtMapeo').val()), "NombreIcono": $('#txtNombreIcono').val(), "DescripcionGeneral": $("#txtDesGen").val(), "FechaBaja": FechaBaja, "Activo": Activo });
                        //var url = obtenerURL('/Mantenimiento/ActualizarOpcAso?Id=' + $('#txtOpcionId').val().toString() + '&opcionjson=' + opcionjson);
                        var data = new FormData();
                        data.append("Id", $('#txtOpcionId').val().toString());
                        data.append("opcionjson", opcionjson);

                        request = $.ajax({
                            url: '@Url.Action("ActualizarOpcAso", "Mantenimiento")',
                            type: "POST",
                            processData: false,
                            contentType: false,
                            data: data
                        });
                        request.done(function (response, textStatus, jqXHR) {
                            var listado = JSON.parse(response);
                            if (listado.Resultado === "true") {
                                    alertify.alert().destroy();
                                    alertify.alert('Confirmación', listado.Mensaje);
                                    alertify.alert().setting('modal', true);
                                    $('#frOpcAso').empty();
                                    $('#frOpcAso').load(obtenerURL("/Mantenimiento/ListaOpcAso"))
                            }
                            else {
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        });



                        //$.post(url)
                        //    .done(function (data) {
                        //        var listado = JSON.parse(data);
                        //        if (listado.Resultado === "true") {
                        //            alertify.alert().destroy();
                        //            alertify.alert('Confirmación', listado.Mensaje);
                        //            alertify.alert().setting('modal', true);
                        //            $('#frOpcAso').empty();
                        //            $('#frOpcAso').load(obtenerURL("/Mantenimiento/ListaOpcAso"))
                        //        }
                        //        else {
                        //            alertify.alert().destroy();
                        //            alertify.alert('Advertencia', listado.Mensaje);
                        //            alertify.alert().setting('modal', true);
                        //        }
                        //    })
                        closealertify();
                    }
                }

                function AgregarOpcAso() {
                    var bandera = true;
                    var FechaBaja = null;
                    if ($('#txtOpcionId').val().toString().length < 1) {
                        $("#lblopcionid").show();
                        bandera = false;
                    }
                    if ($('#txtOpcion').val().toString().length < 1) {
                        $("#lblopcion").show();
                        bandera = false;
                    }
                    if ($('#txtOpcionTipo').val().toString().length < 1) {
                        $("#lblopciontipo").show();
                        bandera = false;
                    }
                    if (bandera == true) {
                        showalertify();
                        $("#lblopcionid").hide();
                        $("#lblopcion").hide();
                        $("#lblopciontipo").hide();

                        var listaCheck = $("#ActivoOpc input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                Activo = value.value
                                if (Activo === "false") {
                                    FechaBaja = formatFechaHoras(new Date)
                                }
                            }
                        })

                        var opcionjson = JSON.stringify({ "OpcionId": $('#OpcionIdtxt').val() + $('#txtOpcionId').val().toString().substring(1), "Opcion": $('#txtOpcion').val().toString(), "OpcionTipo": $('#txtOpcionTipo').val().toString(), "Mapeo": $.trim($('#txtMapeo').val()), "NombreIcono": $('#txtNombreIcono').val(), "DescripcionGeneral": $("#txtDesGen").val(), "FechaBaja": FechaBaja, "Activo": Activo });
                        //var url = obtenerURL('/Mantenimiento/AgregarOpcAso?opcionjson=' + opcionjson);
                        var data = new FormData();                        
                        data.append("opcionjson", opcionjson);

                        request = $.ajax({
                            url: '@Url.Action("AgregarOpcAso", "Mantenimiento")',
                            type: "POST",
                            processData: false,
                            contentType: false,
                            data: data
                        });
                        request.done(function (response, textStatus, jqXHR) {
                            var listado = JSON.parse(response);
                            if (listado.Resultado === "true") {
                                    alertify.alert().destroy();
                                    alertify.alert('Confirmación', listado.Mensaje);
                                    alertify.alert().setting('modal', true);
                                    $('#frOpcAso').empty();
                                    $('#frOpcAso').load(obtenerURL("/Mantenimiento/ListaOpcAso"))
                            }
                            else {
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        });

                        //$.post(url)
                        //   .done(function (data) {
                        //       var listado = JSON.parse(data);
                        //       if (listado.Resultado === "true") {
                        //           $('#frOpcAso').empty();
                        //           $('#frOpcAso').load(obtenerURL("/Mantenimiento/ListaOpcAso"))
                        //           alertify.alert().destroy();
                        //           alertify.alert('Confirmación', listado.Mensaje);
                        //           alertify.alert().setting('modal', true);
                        //       }
                        //       else {
                        //           alertify.alert().destroy();
                        //           alertify.alert('Advertencia', listado.Mensaje);
                        //           alertify.alert().setting('modal', true);
                        //       }
                        //   })
                        closealertify();
                    }
                }

                function NuevaOpcAso() {
                    $('#txtOpcionId').prop("disabled", false);
                    $('#txtOpcionId').val("");
                    $('#txtNivel').val("");
                    $('#txtPadreId').val("");
                    $('#txtOpcion').val("");
                    $('#txtOpcionTipo').val("");
                    $('#txtMapeo').val("");
                    $('#txtNombreIcono').val("");
                    $('#txtDesGen').val("");
                    $('#btnActualizarOpcAso').hide();
                    $('#btnGuardaOpcAso').show();
                    $('#ActivoOpc input[type=checkbox]').prop("checked", false);
                    $('#activoopc').prop('checked', true);
                }

                $(document).ready(function () {
                    $('#txtNivel').prop("disabled", true);
                    $('#txtPadreId').prop("disabled", true);

                    $('#ActivoOpc input[type=checkbox]').click(function () {
                        $('#ActivoOpc input[type=checkbox]').prop("checked", false);
                        $(this).prop("checked", true);
                    });
                })
        </script>
    , true);
}
