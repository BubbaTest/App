@model  Gaia.DAL.Model.CampoReporte

<div class="content">
    <div class="flex-grid">
        <div class="row padding10 flex-jus-center">
            <div class="cell size8 padding10 no-padding-left">
                <div data-role="window" class="window">
                    <div class="window-caption">
                        <span class="window-caption-title">CampoReporte</span>
                    </div>
                    <div class="window-content">
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.CampoReporteId, new { id = "txtCampoReporteId", PlaceHolder = "CampoReporteId" })
                                    @Html.ValidationMessage("camporeporteid", "* Campo Requerido *", new { id = "lblcamporeporteid", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.DropDownListFor(model => model.TipoObjetoId, new SelectList(ViewBag.TipObj as System.Collections.IEnumerable, "TipoObjetoId", "Descripcion"),
                                            "", new { id = "ddlTipoObjetoId", @class = "tipobj" })                                    
                                    @Html.ValidationMessage("tipobjetoid", "* Campo Requerido *", new { id = "lbltipobjetoid", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.Placeholder, new { id = "txtPlaceholder", PlaceHolder = "Placeholder" })
                                    @Html.ValidationMessage("placeholder", "* Campo Requerido *", new { id = "lblplaceholder", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.TextBoxFor(model => model.Titulo, new { id = "txtTitulo", PlaceHolder = "Titulo" })
                                    @Html.ValidationMessage("titulo", "* Campo Requerido *", new { id = "lbltitulo", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>                        
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <label class="input-control text full-size">
                                    @Html.DropDownListFor(model => model.ParametroId, new SelectList(ViewBag.Par as System.Collections.IEnumerable, "ParametroId", "Descripcion"),
                                            "", new { id = "ddlParametroId", @class = "par" })
                                    @Html.ValidationMessage("parametro", "* Campo Requerido *", new { id = "lblparametro", @style = "color:red; display: none;" })
                                </label>
                            </div>
                        </div>                        
                        <div class="row flex-just-center" id="ActivoCamRep">
                            <label class="input-control checkbox small-check">
                                <input type="checkbox" id="activocamprep" value="true" checked>
                                <span class="check"></span>
                                <span class="caption">Activo</span>
                            </label>
                            <label class="input-control checkbox small-check">
                                <input type="checkbox" id="inactivocamprep" value="false">
                                <span class="check"></span>
                                <span class="caption">Inactivo</span>
                            </label>
                        </div>
                        <div class="row flex-just-center" id="PrincipalCamRep">
                            <label class="input-control checkbox small-check">
                                <input type="checkbox" id="isprincipalcamrep" value="true" checked>
                                <span class="check"></span>
                                <span class="caption">Principal</span>
                            </label>
                            <label class="input-control checkbox small-check">
                                <input type="checkbox" id="notisprincipalcamrep" value="false">
                                <span class="check"></span>
                                <span class="caption">No Principal</span>
                            </label>
                        </div>
                        <div class="row flex-just-center">
                            <div class="toolbar">
                                <div class="toolbar-section">
                                    <button class="image-button ribbed-darkBlue" data-tabcontinuar="data-tabcontinuar" id="btnGuardaCampoReporte" onclick="AgregarCampoReporte()">
                                        <span class="fg-white">Guardar</span>
                                        <span class="icon mif-floppy-disk fg-white bg-darkBlue"></span>
                                    </button>
                                    <button class="image-button ribbed-darkOrange" data-tabcontinuar="data-tabcontinuar" id="btnActualizarCampoReporte" onclick="ActualizarCampoReporte()" style="display: none">
                                        <span class="fg-white">Actualizar</span>
                                        <span class="icon mif-pencil fg-white bg-darkOrange"></span>
                                    </button>
                                    <button class="image-button ribbed-darkEmerald" data-tabcontinuar="data-tabcontinuar" id="btnNuevoCampoReporte" onclick="NuevaCampoReporte()">
                                        <span class="fg-white">Nuevo</span>
                                        <span class="icon mif-plus fg-white bg-darkEmerald"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
                function ActualizarCampoReporte() {
                    var bandera = true;
                    if ($('#txtCampoReporteId').val().toString().length < 1) {
                        $("#lblcamporeporteid").show();
                        bandera = false;
                    }

                    if ($('#ddlTipoObjetoId').val().toString().length < 1) {
                        $("#lbltipobjetoid").show();
                        bandera = false;
                    }

                    if ($('#txtPlaceholder').val().toString().length < 1) {
                        $("#lblplaceholder").show();
                        bandera = false;
                    }

                    if ($('#txtTitulo').val().toString().length < 1) {
                        $("#lbltitulo").show();
                        bandera = false;
                    }

                    if ($('#ddlParametroId').val().toString().length < 1) {
                        $("#lblparametro").show();
                        bandera = false;
                    }

                    if (bandera == true) {
                        $("#lblcamporeporteid").hide();
                        $("#lbltipobjetoid").hide();
                        $("#lblplaceholder").hide();
                        $("#lbltitulo").hide();
                        $("#lblparametro").hide();

                        var listaCheck = $("#ActivoCamRep input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                Activo = value.value
                            }
                        })

                        var listaCheck = $("#PrincipalCamRep input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                Principal = value.value
                            }
                        })

                        var camporeportejson = JSON.stringify({ "CampoReporteId": $.trim($('#txtCampoReporteId').val()), "TipoObjetoId": $('#ddlTipoObjetoId').val(), "Placeholder": $('#txtPlaceholder').val(), "Titulo": $('#txtTitulo').val(), "ParametroId": $('#ddlParametroId').val(), "Activo": Activo, "IsPrincipal": Principal });
                        var url = obtenerURL('/Mantenimiento/ActualizarCampoReporte?camporeportejson=' + camporeportejson);
                        $.post(url)
                            .done(function (data) {
                                var listado = JSON.parse(data);
                                if (listado.Resultado === "true") {
                                    $('#frCamRep').empty();
                                    $('#frCamRep').load(obtenerURL("/Mantenimiento/ListaCampoReporte"))
                                    alertify.alert().destroy();
                                    alertify.alert('Confirmación', listado.Mensaje);
                                    alertify.alert().setting('modal', true);
                                }
                                else {
                                    alertify.alert().destroy();
                                    alertify.alert('Advertencia', listado.Mensaje);
                                    alertify.alert().setting('modal', true);
                                }
                            })
                    }
                }

                function AgregarCampoReporte() {
                    var bandera = true;  

                    if ($('#ddlTipoObjetoId').val().toString().length < 1) {
                        $("#lbltipobjetoid").show();
                        bandera = false;
                    }

                    if ($('#txtPlaceholder').val().toString().length < 1) {
                        $("#lblplaceholder").show();
                        bandera = false;
                    }

                    if ($('#txtTitulo').val().toString().length < 1) {
                        $("#lbltitulo").show();
                        bandera = false;
                    }

                    if ($('#ddlParametroId').val().toString().length < 1) {
                        $("#lblparametro").show();
                        bandera = false;
                    }

                    if (bandera == true) {                        
                        $("#lblcamporeporteid").hide();
                        $("#lbltipobjetoid").hide();
                        $("#lblplaceholder").hide();
                        $("#lbltitulo").hide();
                        $("#lblparametro").hide();

                        var listaCheck = $("#ActivoCamRep input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                Activo = value.value                                
                            }
                        })

                        var listaCheck = $("#PrincipalCamRep input[type='checkbox']");
                        $.each(listaCheck, function (index, value) {
                            if ($(value).prop('checked') === true) {
                                Principal = value.value
                            }
                        })

                        var camporeportejson = JSON.stringify({ "TipoObjetoId": $('#ddlTipoObjetoId').val(), "Placeholder": $('#txtPlaceholder').val(), "Titulo": $('#txtTitulo').val(), "ParametroId": $('#ddlParametroId').val(), "Activo": Activo, "IsPrincipal": Principal }); //"CampoReporteId": $.trim($('#txtCampoReporteId').val()),
                        var url = obtenerURL('/Mantenimiento/AgregarCampoReporte?camporeportejson=' + camporeportejson);
                        $.post(url)
                           .done(function (data) {
                               var listado = JSON.parse(data);
                               if (listado.Resultado === "true") {
                                   $('#frCamRep').empty();
                                   $('#frCamRep').load(obtenerURL("/Mantenimiento/ListaCampoReporte"))
                                   alertify.alert().destroy();
                                   alertify.alert('Confirmación', listado.Mensaje);
                                   alertify.alert().setting('modal', true);
                               }
                               else {
                                   alertify.alert().destroy();
                                   alertify.alert('Advertencia', listado.Mensaje);
                                   alertify.alert().setting('modal', true);
                               }
                           })                        
                    }
                }

                function NuevaCampoReporte() {
                    $('#txtCampoReporteId').prop("disabled", true);
                    $('#txtCampoReporteId').val("");                    
                    $('#ddlTipoObjetoId').select2("val", "ca");                    
                    $('#txtPlaceholder').val("");
                    $('#txtTitulo').val("");
                    $('#ddlParametroId').select2("val", "ca");                    
                    $('#ActivoCamRep input[type=checkbox]').prop("checked", false);
                    $('#activocamprep').prop('checked', true);
                    $('#PrincipalCamRep input[type=checkbox]').prop("checked", false);                    
                    $('#isprincipalcamrep').prop('checked', true);
                    $('#btnActualizarCampoReporte').hide();
                    $('#btnGuardaCampoReporte').show();
                }

                $(document).ready(function () {
                    $('#txtCampoReporteId').prop("disabled", true);

                    $(".tipobj").select2({
                        placeholder: "Seleccione Tipo Objeto", dropdownAutoWidth: true, tags: true, width: '100%',
                    });

                    $(".par").select2({
                        placeholder: "Seleccione Parametro", dropdownAutoWidth: true, tags: true, width: '100%',
                    });

                    $('#ActivoCamRep input[type=checkbox]').click(function () {
                        $('#ActivoCamRep input[type=checkbox]').prop("checked", false);
                        $(this).prop("checked", true);
                    });

                    $('#PrincipalCamRep input[type=checkbox]').click(function () {
                        $('#PrincipalCamRep input[type=checkbox]').prop("checked", false);
                        $(this).prop("checked", true);
                    });
                })
        </script>
    , true);
}

