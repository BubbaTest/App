@model  Gaia.DAL.Model.Usuario

@Html.Hidden("hfIdMenu")
<div class="content">
    <div class="flex-grid">
        <div class="row padding10 flex-jus-center">
            <div class="cell size12 padding10 no-padding-left">
                <div data-role="window" class="window">
                    <div class="window-caption">
                        <span class="window-caption-title">Menú</span>
                    </div>
                    <div class="window-content">
                        <div class="row flex-just-center">
                            <div class="cell size6">
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.DropDownListFor(model => model.Persona.strEntidad, new SelectList(ViewBag.tablaModulo as System.Collections.IEnumerable, "IdModulo", "DescpModulo"),
                                            "Selecciona Modulo", new { id = "ddlModuloId", @class = "Mod" })
                                            @Html.ValidationMessage("moduloid", "* Campo Requerido *", new { id = "lblmoduloid", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Correo, new { id = "txtmenupadre", PlaceHolder = "menu_padre" })
                                            @Html.ValidationMessage("menu_padre", "* Campo Requerido *", new { id = "lblmenupadre", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Correo, new { id = "txtcodigomen", PlaceHolder = "codigo" })
                                            @Html.ValidationMessage("codigo", "* Campo Requerido *", new { id = "lblcodigo", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Correo, new { id = "txtnombremen", PlaceHolder = "nombre" })
                                            @Html.ValidationMessage("nombre", "* Campo Requerido *", new { id = "lblnombre", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Correo, new { id = "txtdescripcionmen", PlaceHolder = "descripcion" })
                                            @Html.ValidationMessage("descripcion", "* Campo Requerido *", new { id = "lbldescripcionmen", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="cell size6">
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Persona.strNombreCompleto, new { id = "txturl", PlaceHolder = "url" })
                                            @Html.ValidationMessage("url", "* Campo Requerido *", new { id = "lblurl", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Persona.strNombreCompleto, new { id = "txttipo", PlaceHolder = "tipo" })
                                            @Html.ValidationMessage("tipo", "* Campo Requerido *", new { id = "lbltipo", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Persona.strNombreCompleto, new { id = "txtorden", PlaceHolder = "orden" })
                                            @Html.ValidationMessage("orden", "* Campo Requerido *", new { id = "lblordenmen", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Persona.strNombreCompleto, new { id = "txtnivel", PlaceHolder = "nivel" })
                                            @Html.ValidationMessage("nivel", "* Campo Requerido *", new { id = "lblnivel", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center" id="blnEstado">
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="activoblnEstado" value="true" checked>
                                        <span class="check"></span>
                                        <span class="caption">Activo</span>
                                    </label>
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="inactivoblnEstado" value="false">
                                        <span class="check"></span>
                                        <span class="caption">Inactivo</span>
                                    </label>
                                </div> 
                            </div>
                        </div>
                        <div class="row flex-just-center">
                            <div class="toolbar">
                                <div class="toolbar-section">
                                    <button class="image-button ribbed-darkBlue" data-tabcontinuar="data-tabcontinuar" onclick="AgregarMenSap()" id="btnGuardaMenuSap">
                                        <span class="fg-white">Guardar</span>
                                        <span class="icon mif-floppy-disk fg-white bg-darkBlue"></span>
                                    </button>
                                    <button class="image-button ribbed-darkOrange" data-tabcontinuar="data-tabcontinuar" id="btnActualizarMenuSap" style="display: none" onclick="ActualizarMenuSap()">
                                        <span class="fg-white">Actualizar</span>
                                        <span class="icon mif-pencil fg-white bg-darkOrange"></span>
                                    </button>
                                    <button class="image-button ribbed-darkEmerald" data-tabcontinuar="data-tabcontinuar" id="btnNuevoMenuSap" onclick="NuevaMenu()">
                                        <span class="fg-white">Nuevo</span>
                                        <span class="icon mif-plus fg-white bg-darkEmerald"></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
            $(document).ready(function () {
                $(".Mod").select2({
                    placeholder: "Seleccione Módulo", dropdownAutoWidth: true, tags: true, width: '100%',
                });

                $('#blnEstado input[type=checkbox]').click(function () {
                    $('#blnEstado input[type=checkbox]').prop("checked", false);
                    $(this).prop("checked", true);
                });                
            });

            function AgregarMenSap() {
                var bandera = true;
                var menjson;
                showalertify();

                if ($('#ddlModuloId').val().toString().length < 1) {
                    $("#lblmoduloid").show();
                    bandera = false;
                }
                
                if (bandera == true) {
                    $("#lblmoduloid").hide();                    

                    var listaCheck = $("#blnEstado input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            Estado = value.value
                        }
                    });                    

                    menjson = JSON.stringify({ "IdModulo": $('#ddlModuloId').val(), "menu_padre": $('#txtmenupadre').val(), "codigo": $("#txtcodigomen").val(), "nombre": $("#txtnombremen").val(), "descripcion": $("#txtdescripcionmen").val(), "url": $("#txturl").val(), "tipo": $("#txttipo").val(), "estado": Estado, "orden": $("#txtorden").val(), "nivel": $("#txtnivel").val(), "dtFechaInsercion": formatFechaHoras(new Date), "id_usuario": "1" });

                    var url = obtenerURL('/Mantenimiento/GuardarMenSap?json=' + menjson);
                    $.post(url)
                        .done(function (data) {
                            var listado = JSON.parse(data);

                            if (listado.Resultado === "true") {
                                $('#frMenuSap').empty();
                                $('#frMenuSap').load(obtenerURL("/Mantenimiento/ListaMenuSap"));
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Confirmación', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                            else {
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        })
                }
                else {
                    closealertify();
                    alertify.alert().destroy();
                    alertify.alert('Advertencia', 'Llenar todos los campos obligatorios');
                    alertify.alert().setting('modal', true);
                }
            }

            function ActualizarMenSap() {
                var bandera = true;
                var menjson;
                showalertify();

                if ($('#ddlModuloId').val().toString().length < 1) {
                    $("#lblmoduloid").show();
                    bandera = false;
                }

                if (bandera == true) {
                    $("#lblmoduloid").hide();

                    var listaCheck = $("#blnEstado input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            Estado = value.value
                        }
                    });

                    menjson = JSON.stringify({ "IdModulo": $('#ddlModuloId').val(), "menu_padre": $('#txtmenupadre').val(), "codigo": $("#txtcodigomen").val(), "nombre": $("#txtnombremen").val(), "descripcion": $("#txtdescripcionmen").val(), "url": $("#txturl").val(), "tipo": $("#txttipo").val(), "estado": Estado, "orden": $("#txtorden").val(), "nivel": $("#txtnivel").val() });

                    var url = obtenerURL('/Mantenimiento/ActualizarMenSap?json=' + menjson + '&Idmenu=' + $("#hfIdMenu").val()); 
                    $.post(url)
                        .done(function (data) {
                            var listado = JSON.parse(data);

                            if (listado.Resultado === "true") {
                                $('#frMenuSap').empty();
                                $('#frMenuSap').load(obtenerURL("/Mantenimiento/ListaMenuSap"));
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Confirmación', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                            else {
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        })
                }
                else {
                    closealertify();
                    alertify.alert().destroy();
                    alertify.alert('Advertencia', 'Llenar todos los campos obligatorios');
                    alertify.alert().setting('modal', true);
                }
            }

            function NuevaAccion() {
                $('#ddlModuloId').select2("val", "ca");
                $('#txtmenupadre').val("");
                $('#txtcodigomen').val("");
                $('#txtnombremen').val("");
                $('#txtdescripcionmen').val("");
                $('#txturl').val("");
                $('#txttipo').val("");
                $('#txtorden').val("");
                $('#txtnivel').val("");
                $("#blnEstado").prop("checked", true);
                $("#activoblnEstado").prop("checked", true);                
                $('#btnActualizarMenuSap').hide();
                $('#btnGuardaMenuSap').show();
            }
        </script>
    , true);
}

