@model  Gaia.DAL.Model.Usuario

<style>
    .switch {
        font-size: 1rem;
        position: relative;
    }

    .switch input {
        position: absolute;
        height: 1px;
        width: 1px;
        background: none;
        border: 0;
        clip: rect(0 0 0 0);
        clip-path: inset(50%);
        overflow: hidden;
        padding: 0;
    }

    .switch input + label {
        position: relative;
        min-width: calc(calc(2.375rem * 0.8) * 2);
        border-radius: calc(2.375rem * 0.8);
        height: calc(2.375rem * 0.8);
        line-height: calc(2.375rem * 0.8);
        display: inline-block;
        cursor: pointer;
        outline: none;
        user-select: none;
        vertical-align: middle;
        text-indent: calc(calc(calc(2.375rem * 0.8) * 2) + 0.5rem);
    }

    .switch input + label::before,
    .switch input + label::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: calc(calc(2.375rem * 0.8) * 2);
        bottom: 0;
        display: block;
    }

    .switch input + label::before {
        right: 0;
        background-color: #dee2e6;
        border-radius: calc(2.375rem * 0.8);
        transition: 0.2s all;
    }

    .switch input + label::after {
        top: 2px;
        left: 2px;
        width: calc(calc(2.375rem * 0.8) - calc(2px * 2));
        height: calc(calc(2.375rem * 0.8) - calc(2px * 2));
        border-radius: 50%;
        background-color: white;
        transition: 0.2s all;
    }

    .switch input:checked + label::before {
        background-color: #08d;
    }

    .switch input:checked + label::after {
        margin-left: calc(2.375rem * 0.8);
    }

    .switch input:focus + label::before {
        outline: none;
        box-shadow: 0 0 0 0.2rem rgba(0, 136, 221, 0.25);
    }

    .switch input:disabled + label {
        color: #868e96;
        cursor: not-allowed;
    }

    .switch input:disabled + label::before {
        background-color: #e9ecef;
    }

    .switch.switch-h {
        font-size: 0.875rem;
    }

    .switch.switch-h input + label {
        min-width: calc(calc(1.9375rem * 0.8) * 2);
        height: calc(1.9375rem * 0.8);
        line-height: calc(1.9375rem * 0.8);
        text-indent: calc(calc(calc(1.9375rem * 0.8) * 2) + 0.5rem);
    }

    .switch.switch-h input + label::before {
        width: calc(calc(1.9375rem * 0.8) * 2);
    }

    .switch.switch-h input + label::after {
        width: calc(calc(1.9375rem * 0.8) - calc(2px * 2));
        height: calc(calc(1.9375rem * 0.8) - calc(2px * 2));
    }

    .switch.switch-h input:checked + label::after {
        margin-left: calc(1.9375rem * 0.8);
    }

    .switch.switch-lg {
        font-size: 1.25rem;
    }

    .switch.switch-lg input + label {
        min-width: calc(calc(3rem * 0.8) * 2);
        height: calc(3rem * 0.8);
        line-height: calc(3rem * 0.8);
        text-indent: calc(calc(calc(3rem * 0.8) * 2) + 0.5rem);
    }

    .switch.switch-lg input + label::before {
        width: calc(calc(3rem * 0.8) * 2);
    }

    .switch.switch-lg input + label::after {
        width: calc(calc(3rem * 0.8) - calc(2px * 2));
        height: calc(calc(3rem * 0.8) - calc(2px * 2));
    }

    .switch.switch-lg input:checked + label::after {
        margin-left: calc(3rem * 0.8);
    }

    .switch + .switch {
        margin-left: 1rem;
    }
</style>

@Html.Hidden("hfidUsuario")
<div class="content">
    <div class="flex-grid">
        <div class="row padding10 flex-jus-center">
            <div class="cell size8 padding10 no-padding-left">
                <div data-role="window" class="window">
                    <div class="window-caption">
                        <span class="window-caption-title">Usuario</span>
                    </div>
                    <div class="window-content">
                        <div class="row flex-just-center">
                            <div class="cell size12">
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            <select id="txtEmpleadoId"></select>
                                            @Html.ValidationMessage("empleadoid", "* Campo Requerido *", new { id = "lblempleadoid", @style = "color:red; display: none;" })                                            
                                        </label>

                                    </div>
                                </div>  
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.UsuarioId, new { id = "txtchrcodempleado", PlaceHolder = "No Empleado" })
                                            @Html.ValidationMessage("usuarioid", "* Campo Requerido *", new { id = "lblusuarioid", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>                                
                                                              
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.TextBoxFor(model => model.Correo, new { id = "txtlogin", PlaceHolder = "Login" })
                                            @Html.ValidationMessage("login", "* Campo Requerido *", new { id = "lbllogin", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center">
                                    <div class="cell size6">
                                        <label class="input-control text full-size">
                                            @Html.DropDownListFor(model => model.EstadoId, new SelectList(ViewBag.EntidadesIml as System.Collections.IEnumerable, "intCodEntidadPJ", "strSinonimo"),
                                            "Selecciona iml", new { id = "ddldeliml", @class = "tets" })
                                            @Html.ValidationMessage("entidadg", "* Campo Requerido *", new { id = "lblentidadg", @style = "color:red; display: none;" })
                                        </label>
                                    </div>
                                </div>
                                <div class="row flex-just-center" id="blnEstado">
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="activoblnEstado" value="true" checked>
                                        <span class="check"></span>
                                        <span class="caption">Activo</span>
                                    </label>
                                    <label class="input-control checkbox small-check">
                                        <input type="checkbox" id="inactivoblnEstado" value="false">
                                        <span class="check"></span>
                                        <span class="caption">Inactivo</span>
                                    </label>
                                </div>
                                <div class="row flex-just-center" id="blnDel">                                    
                                    <div class="item-btn">
                                        <div class="container-switch">
                                            <span class="switch switch-h">
                                                <input type="checkbox" class="switch" id="switch-h">
                                                <label for="switch-h">Todas las Delegaciones?</label>
                                            </span>
                                        </div>
                                    </div>                                    
                                </div>
                            </div>                            
                        </div>
                        <div class="row flex-just-center">
                            <div class="toolbar">
                                <div class="toolbar-section">
                                    <button class="image-button ribbed-darkBlue" data-tabcontinuar="data-tabcontinuar" onclick="AgregarUsuarioGaleno()" id="btnGuardaUsuarioGaleno">
                                        <span class="fg-white">Guardar</span>
                                        <span class="icon mif-floppy-disk fg-white bg-darkBlue"></span>
                                    </button>
                                    <button class="image-button ribbed-darkOrange" data-tabcontinuar="data-tabcontinuar" id="btnActualizarUsuarioGaleno" style="display: none" onclick="ActualizarUsuarioGaleno()">
                                        <span class="fg-white">Actualizar</span>
                                        <span class="icon mif-pencil fg-white bg-darkOrange"></span>
                                    </button>
                                    <button class="image-button ribbed-darkEmerald" data-tabcontinuar="data-tabcontinuar" id="btnNuevoUsuarioGaleno" onclick="btnNuevoUsuarioGaleno()">
                                        <span class="fg-white">Nuevo</span>
                                        <span class="icon mif-plus fg-white bg-darkEmerald"></span>
                                    </button>                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@using (Html.BeginScriptContext())
{
    Html.AddScriptBlock(
        @<script type="text/javascript">
            
            $(document).ready(function () {
                $('#txtchrcodempleado').prop("disabled", true);

                $('#txtEmpleadoId').select2({
                    ajax: {
                        url: obtenerURL("/Mantenimiento/FiltrarEmpleado"),
                        dataType: 'json',
                        delay: 250,
                        type: "GET",
                        data: function (params) { return { nombre: params.term, tipo: "GAL" };},
                        processResults: function (data) {
                            return {
                                results: $.map(data, function (obj) { return { id: obj.Identificador, text: obj.strNombreCompleto }; })
                            };
                        }
                    },
                    width: '520px', minimumInputLength: 9, placeholder: "Seleccione un Empleado", allowClear: true
                });

                $("#txtEmpleadoId").on("change", function (b) {
                    $("#txtchrcodempleado").val($("#txtEmpleadoId").val())                    
                });                

                $(".tets").select2({
                    placeholder: "Seleccione Entidad", dropdownAutoWidth: true, tags: true, width: '100%',
                });

                $('#blnEstado input[type=checkbox]').click(function () {
                    $('#blnEstado input[type=checkbox]').prop("checked", false);
                    $(this).prop("checked", true);
                });
            });                                             

            function AgregarUsuarioGaleno() {
                var bandera = true;
                showalertify();

                if ($('#txtlogin').val().toString().length < 1) {
                    $("#lbllogin").show();
                    bandera = false;
                }

                if ($('#ddldeliml').val().toString().length < 1) {
                    $("#lblentidadg").show();
                    bandera = false;
                }                

                if (bandera == true) {
                    $("#lbllogin").hide();
                    $("#lblentidadg").hide();

                    var listaCheck = $("#blnEstado input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            Activo = value.value
                        }
                    });                    

                    if ($('#switch-h').prop('checked')) { Delegaciones = true; }
                    else { Delegaciones = false; }                                                        

                    var usugaljson = JSON.stringify({ "chrCodEmpleado": $('#txtchrcodempleado').val(), "strLogin": $('#txtlogin').val(), "intCodDelegacionIML": $('#ddldeliml').val(), "blnEstado": Activo, "blDelegaciones": Delegaciones });

                    var url = obtenerURL('/Mantenimiento/GuardarUsuarioGaleno?json=' + usugaljson);
                    $.post(url)
                        .done(function (data) {
                            var listado = JSON.parse(data);

                            if (listado.Resultado === "true") {
                                $('#frUsuarioGal').empty();
                                $('#frUsuarioGal').load(obtenerURL("/Mantenimiento/ListaUsuarioGaleno"));
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Confirmación', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                            else {
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        })
                }
                else {
                    closealertify();
                    alertify.alert().destroy();
                    alertify.alert('Advertencia', 'Llenar todos los campos obligatorios');
                    alertify.alert().setting('modal', true);
                }
            }            

            function ActualizarUsuarioGaleno() {
                var bandera = true;
                showalertify();

                if ($('#txtEmpleadoId').val().toString().length < 1) {
                    $("#lblempleadoid").show();
                    bandera = false;
                }

                if ($('#txtlogin').val().toString().length < 1) {
                    $("#lbllogin").show();
                    bandera = false;
                }

                if (bandera == true) {
                    $("#lblempleadoid").hide();
                    $("#lbllogin").hide();

                    var listaCheck = $("#blnEstado input[type='checkbox']");
                    $.each(listaCheck, function (index, value) {
                        if ($(value).prop('checked') === true) {
                            Activo = value.value
                        }
                    });
                     
                    var usugaljson = JSON.stringify({ "strLogin": $('#txtlogin').val(), "chrCodEmpleado": $('#txtchrcodempleado').val(), "intCodDelegacionIML": $('#ddldeliml').val(), "blnEstado": Activo });

                    var url = obtenerURL('/Mantenimiento/ActualizaUsuarioGaleno?json=' + usugaljson + '&Usuario=' + $("#hfidUsuario").val());                    
                    $.post(url)
                        .done(function (data) {
                            var listado = JSON.parse(data);

                            if (listado.Resultado === "true") {
                                $('#frUsuarioGal').empty();
                                $('#frUsuarioGal').load(obtenerURL("/Mantenimiento/ListaUsuarioGaleno"));
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Confirmación', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                            else {
                                closealertify();
                                alertify.alert().destroy();
                                alertify.alert('Advertencia', listado.Mensaje);
                                alertify.alert().setting('modal', true);
                            }
                        })
                }
                else {
                    closealertify();
                    alertify.alert().destroy();
                    alertify.alert('Advertencia', 'Llenar todos los campos obligatorios');
                    alertify.alert().setting('modal', true);
                }
            }  

            function btnNuevoUsuarioGaleno() {
                $('#txtEmpleadoId').select2("val", "ca");
                $('#txtchrcodempleado').val("");
                $('#txtchrcodempleado').prop("disabled", false);
                $('#txtlogin').val("");                
                $('#ddldeliml').select2("val", "ca");
                $('#blnEstado input[type=checkbox]').prop("checked", false);
                $('#activoblnEstado').prop('checked', true);
                $('#switch-h').prop('checked', false);                
                $('#btnActualizarUsuarioGaleno').hide();                
                $('#btnGuardaUsuarioGaleno').show();
            }            
        </script>
    , true);
}
